@model QLHV.Models.KetQuaHocTap
@{
    ViewData["Title"] = "Sửa kết quả học tập";
}

<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm border-0" style="border-radius: 15px;">
                <div class="card-header bg-warning text-white border-0" style="border-radius: 15px 15px 0 0;">
                    <div class="d-flex align-items-center">
                        <a asp-action="Index" class="btn btn-outline-light btn-sm me-3">
                            <i class="bi bi-arrow-left"></i>
                        </a>
                        <h5 class="card-title mb-0">
                            <i class="bi bi-pencil me-2"></i>@ViewData["Title"]
                        </h5>
                    </div>
                </div>
                <div class="card-body p-4">
                    <form asp-action="Edit" method="post">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
                        
                        <input type="hidden" asp-for="MaKetQua" />
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="MaNguoi" class="form-label fw-bold">
                                        Học viên <span class="text-danger">*</span>
                                    </label>
                                    <select asp-for="MaNguoi" asp-items="ViewBag.MaNguoi" class="form-select" required>
                                        <option value="">-- Chọn học viên --</option>
                                    </select>
                                    <span asp-validation-for="MaNguoi" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="NamHoc" class="form-label fw-bold">
                                        Năm học <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="NamHoc" class="form-control" placeholder="VD: 2023-2024" required />
                                    <span asp-validation-for="NamHoc" class="text-danger"></span>
                                    <div class="form-text">Định dạng: YYYY-YYYY (VD: 2023-2024)</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="DiemTrungBinh" class="form-label fw-bold">
                                        Điểm trung bình <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="DiemTrungBinh" type="number" step="0.1" min="0" max="10" 
                                           class="form-control" placeholder="VD: 8.5" required />
                                    <span asp-validation-for="DiemTrungBinh" class="text-danger"></span>
                                    <div class="form-text">Điểm từ 0.0 đến 10.0</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Xếp loại</label>
                                    <div class="form-control-plaintext" id="xepLoai">
                                        @if (Model.DiemTrungBinh.HasValue)
                                        {
                                            var diem = (double)Model.DiemTrungBinh.Value;
                                            string xepLoai = "";
                                            string badgeClass = "bg-secondary";
                                            
                                            if (diem >= 9.0)
                                            {
                                                xepLoai = "Xuất sắc";
                                                badgeClass = "bg-success";
                                            }
                                            else if (diem >= 8.0)
                                            {
                                                xepLoai = "Giỏi";
                                                badgeClass = "bg-success";
                                            }
                                            else if (diem >= 6.5)
                                            {
                                                xepLoai = "Khá";
                                                badgeClass = "bg-warning";
                                            }
                                            else if (diem >= 5.0)
                                            {
                                                xepLoai = "Trung bình";
                                                badgeClass = "bg-info";
                                            }
                                            else
                                            {
                                                xepLoai = "Yếu";
                                                badgeClass = "bg-danger";
                                            }
                                            
                                            <span class="badge @badgeClass fs-6">@xepLoai</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">Nhập điểm để xem xếp loại</span>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label asp-for="GhiChu" class="form-label fw-bold">Ghi chú</label>
                            <textarea asp-for="GhiChu" class="form-control" rows="3" 
                                      placeholder="Nhập ghi chú về kết quả học tập..."></textarea>
                            <span asp-validation-for="GhiChu" class="text-danger"></span>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a asp-action="Index" class="btn btn-secondary btn-lg px-4">
                                <i class="bi bi-arrow-left me-2"></i>Trở về
                            </a>
                            <button type="submit" class="btn btn-warning btn-lg px-4">
                                <i class="bi bi-check-circle me-2"></i>Lưu thay đổi
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        // Tự động tính xếp loại khi nhập điểm
        $('#DiemTrungBinh').on('input', function() {
            const diem = parseFloat($(this).val());
            let xepLoai = '';
            let badgeClass = 'bg-secondary';
            
            if (!isNaN(diem)) {
                if (diem >= 9.0) {
                    xepLoai = 'Xuất sắc';
                    badgeClass = 'bg-success';
                } else if (diem >= 8.0) {
                    xepLoai = 'Giỏi';
                    badgeClass = 'bg-success';
                } else if (diem >= 6.5) {
                    xepLoai = 'Khá';
                    badgeClass = 'bg-warning';
                } else if (diem >= 5.0) {
                    xepLoai = 'Trung bình';
                    badgeClass = 'bg-info';
                } else if (diem >= 0) {
                    xepLoai = 'Yếu';
                    badgeClass = 'bg-danger';
                }
                
                $('#xepLoai').html(`<span class="badge ${badgeClass} fs-6">${xepLoai}</span>`);
            } else {
                $('#xepLoai').html('<span class="text-muted">Nhập điểm để xem xếp loại</span>');
            }
        });
        
        // Tự động format năm học
        $('#NamHoc').on('input', function() {
            let value = $(this).val().replace(/[^0-9-]/g, '');
            
            // Chỉ cho phép một dấu gạch ngang
            const parts = value.split('-');
            if (parts.length > 2) {
                value = parts[0] + '-' + parts[1];
            }
            
            // Giới hạn độ dài
            if (value.length > 9) {
                value = value.substring(0, 9);
            }
            
            $(this).val(value);
        });
    </script>
}

<style>
    .card {
        transition: all 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-2px);
    }
    
    .btn {
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    
    .btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .form-control, .form-select {
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: #ffc107;
        box-shadow: 0 0 0 0.2rem rgba(255, 193, 7, 0.25);
    }
    
    .form-control-plaintext {
        padding: 0.375rem 0.75rem;
        background-color: #f8f9fa;
        border-radius: 0.375rem;
        min-height: 38px;
        display: flex;
        align-items: center;
    }
    
    .badge {
        font-size: 0.875em;
    }
    
    .alert {
        border-radius: 8px;
    }
</style>
