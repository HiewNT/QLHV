@{
    ViewData["Title"] = "Thống kê tổng quan";
}

<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1 text-primary fw-bold">
                <i class="bi bi-graph-up me-2"></i>@ViewData["Title"]
            </h2>
            <p class="text-muted mb-0">Tổng quan thống kê hệ thống quản lý học viên</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-primary" onclick="refreshCharts()">
                <i class="bi bi-arrow-clockwise me-1"></i>Làm mới
            </button>
        </div>
    </div>

    <!-- Thống kê tổng quan - Layout 2x2 -->
    <div class="row g-4 mb-4">
        <div class="col-lg-6">
            <div class="card bg-primary text-white shadow-sm border-0">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-1">Tổng người</h6>
                            <h2 class="mb-0 fw-bold">@ViewBag.TongNguoi</h2>
                        </div>
                        <div class="fs-1">
                            <i class="bi bi-people-fill"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card bg-success text-white shadow-sm border-0">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-1">Tổng học viên</h6>
                            <h2 class="mb-0 fw-bold">@ViewBag.TongHocVien</h2>
                        </div>
                        <div class="fs-1">
                            <i class="bi bi-mortarboard-fill"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card bg-info text-white shadow-sm border-0">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-1">Tổng nhân viên</h6>
                            <h2 class="mb-0 fw-bold">@ViewBag.TongNhanVien</h2>
                        </div>
                        <div class="fs-1">
                            <i class="bi bi-person-badge-fill"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card bg-warning text-white shadow-sm border-0">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-1">Tổng Đảng viên</h6>
                            <h2 class="mb-0 fw-bold">@ViewBag.TongDangVien</h2>
                        </div>
                        <div class="fs-1">
                            <i class="bi bi-star-fill"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Biểu đồ chính -->
    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-0">
                    <h5 class="card-title mb-0 text-primary">
                        <i class="bi bi-pie-chart me-2"></i>Thống kê Đảng viên
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="dangVienChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-0">
                    <h5 class="card-title mb-0 text-primary">
                        <i class="bi bi-bar-chart me-2"></i>Thống kê Học viên
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="hocVienChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let dangVienChart, hocVienChart;

        $(document).ready(function() {
            loadCharts();
        });

        function loadCharts() {
            loadDangVienChart();
            loadHocVienChart();
        }

        function loadDangVienChart() {
            $.get('@Url.Action("GetDangVienData")', function(data) {
                if (dangVienChart) {
                    dangVienChart.destroy();
                }
                
                const ctx = document.getElementById('dangVienChart').getContext('2d');
                dangVienChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            data: data.data,
                            backgroundColor: data.backgroundColor,
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            });
        }

        function loadHocVienChart() {
            $.get('@Url.Action("GetHocVienData")', function(data) {
                if (hocVienChart) {
                    hocVienChart.destroy();
                }
                
                const ctx = document.getElementById('hocVienChart').getContext('2d');
                hocVienChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: 'Số lượng',
                            data: data.data,
                            backgroundColor: data.backgroundColor,
                            borderWidth: 1,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            });
        }

        function refreshCharts() {
            loadCharts();
        }
    </script>
}

